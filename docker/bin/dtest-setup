#!/usr/bin/env bash

set -ex

# find the aws instance IP and set the $SSH_CONN,
# then wait for AWS instance to be up
set -o allexport
source ./bin/instance-wait-for
set +o allexport

# pull the latest copy of cassandra-dtest
${SSH_CONN} "if cd cassandra-dtest; then git pull; else git clone https://github.com/apache/cassandra-dtest.git; fi"

# TESTING ONLY: pull a fork and/or specific branch
${SSH_CONN} "sudo rm -rf cassandra-dtest; git clone https://github.com/joaquincasares/cassandra-dtest-1.git cassandra-dtest"
${SSH_CONN} "cd cassandra-dtest; git checkout parallel-docker-dtests"

# touch the unused secrets.env so docker-compose can be happy
${SSH_CONN} "touch cassandra-dtest/docker/secrets.env"
